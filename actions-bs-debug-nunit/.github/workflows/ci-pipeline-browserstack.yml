name: Android Appium Tests Browserstack Workflow

on:
  workflow_dispatch:
    inputs:
      run_emulator:
        description: "Run emulator check?"
        type: boolean
        default: false
        required: false

jobs:
  ubuntu-job:
    name: 'BrowserStack Test on Ubuntu'
    runs-on: ubuntu-latest
    environment: test
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: 'BrowserStack Env Setup'
        uses: 'browserstack/github-actions/setup-env@master'
        with:
          username:  
          access-key: 
          build-name: BUILD_INFO
          project-name: REPO_NAME
      - name: 'BrowserStackLocal Setup'
        uses: 'browserstack/github-actions/setup-local@master'
        with:
          local-testing: start
          local-identifier: random

      # Setup .NET 8.0
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 8.0.X
          cache: false

      # Setup .NET project  
      - name: Setup .NET project
        run: |
            echo "üîß Setting up .NET"
            dotnet --version
            dotnet build android.csproj --configuration Release

      - name: Boot emulator and run tests
        run: |
          echo "‚úÖ Emulator booting..."

          # Wait a bit more for emulator to fully stabilize
          echo "‚è≥ Waiting a bit more for emulator to stabilize..."
          sleep 30

          # Run tests
          echo "üß™ Running Appium tests"
          dotnet test android.csproj --logger:"console;verbosity=detailed"

      - name: 'BrowserStackLocal Stop'
        uses: 'browserstack/github-actions/setup-local@master'
        with:
          local-testing: stop
          